{
    "$schema": "https://docs.renovatebot.com/renovate-schema.json",
    "extends": [
      "config:recommended"
    ],
    "enabledManagers": ["kubernetes", "helm-values", "argocd", "regex"],
    "baseBranches": ["staging"],
    "kubernetes": {
        "commitMessageTopic": "Kubernetes: {{depName}}",
        "fileMatch": ["(^|/)values.yaml$"]
    },
    "helm-values": {
        "commitMessageTopic": "helm staging: {{depName}}",
        "fileMatch": ["(^|/)values.yaml$"],
        "pinDigests": false
    },
    "argocd":{
        "fileMatch": ["(^|/)values.yaml$"]
    },
    "customManagers": [
        {
            "customType": "regex",
            "fileMatch": ["(^|/)values.yaml$"],
            "matchStrings": [
              "\\s*repo_url: [\"']?(?<registryUrl>.*?)[\"']?\\s+(^.*$\n)*\\s*chart: [\"']?(?<depName>.*?)[\"']?\\s+(^.*$\n)*\\s*version: [\"']?(?<currentValue>.*?)[\"']?\\s+"
            ],
            "datasourceTemplate": "helm"
        },
        {
            "customType": "regex",
            "fileMatch": ["(^|/)values.yaml$"],
            "matchStrings": [ 
                "\\s\\s(?<depName>[a-zA-Z]{3,}):\\n\\s*repo_url:\\s[\\S]+\\n[\\s]{4}github_source:\\s\"https:\\\/\\\/(?<packageName>[\\S]+)\"\\n[\\s]{4}[\\S]+\\s[\\S]+\\n[\\s]{4}version:\\s*[\"']?(?<currentValue>[^\"]+)[\"']?"
            ],
            "datasourceTemplate": "custom.githubfiles"
        }
    ],
    "customDatasources": {
        "githubfiles": {
            "defaultRegistryUrlTemplate": "https://{{packageName}}",
            "format": "yaml",
            "transformTemplates": [
                "{\"releases\":[{\"version\": $string(version)}]}"
            ]
        }
    }
}
